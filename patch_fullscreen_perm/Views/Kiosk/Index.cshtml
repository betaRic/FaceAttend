@{
    Layout = null;
    Response.Cache.SetCacheability(System.Web.HttpCacheability.NoCache);
    Response.Cache.SetNoStore();
}

<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kiosk - FaceAttend</title>

    <!-- PWA manifest (fullscreen when installed) -->
    <link rel="manifest" href="@Url.Content("~/manifest.json")" />
    <meta name="theme-color" content="#0a1810" />

    <!-- iOS PWA hints -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="FaceAttend" />
    <link rel="apple-touch-icon" href="@Url.Content("~/Content/images/dilg-logo-192.png")" />

    <link href="~/Content/kiosk.css?v=@DateTime.UtcNow.Ticks" rel="stylesheet" />

    <!-- Permission modal styles -->
    <link rel="stylesheet" href="@Url.Content("~/Content/kiosk-perm.css")" />

    <link rel="stylesheet" href="@Url.Content("~/Scripts/vendor/toastify/toastify.min.css")" />
</head>
<body data-app-base="@Url.Content("~/")" data-nextgen="@((System.Configuration.ConfigurationManager.AppSettings["Kiosk:UseNextGen"] ?? "false"))" data-return-url="@ViewBag.ReturnUrl" data-unlock-hint="@ViewBag.UnlockHint">
    @Html.AntiForgeryToken()

    <div id="kioskRoot">
        <video id="kioskVideo" playsinline autoplay muted></video>
        <canvas id="overlayCanvas"></canvas>

        <!-- Idle overlay (no server calls until a face/motion is detected locally) -->
        <div id="idleOverlay" class="idleOverlay hidden" aria-hidden="true">
            <div class="idleCard">
                <div class="idleBrand">FaceAttend</div>
                <div class="idleDot" aria-hidden="true"></div>
                <div class="idleTitle">Idle</div>
                <div class="idleSub">Look at the camera to start.</div>
            </div>
        </div>

        <div id="topLeft">
            <div class="brand">FaceAttend</div>
            <div class="sub" id="officeLine">Locating...</div>
        </div>

        <div id="topCenter">
            <div id="timeLine">--:--:--</div>
            <div id="dateLine">----</div>
        </div>

        <div id="topRight">
            <div id="livenessLine">Live: --</div>
            <div id="scanEtaLine">ETA: --</div>
        </div>

        <div id="centerBlock" class="hidden">
            <div class="blockTitle">Not in allowed area.</div>
            <div class="blockSub">Move closer to a designated office.</div>
        </div>

        <div id="bottomCenter">
            <div id="mainPrompt">Ready.</div>
            <div id="subPrompt">Stand still. One face only.</div>
        </div>

        <div id="unlockBackdrop" class="hidden" aria-hidden="true">
            <div id="unlockModal" role="dialog" aria-modal="true" aria-labelledby="unlockTitle">
                <div class="unlockHeader">
                    <div id="unlockTitle" class="unlockTitle">Admin unlock</div>
                    <button id="unlockClose" type="button" class="unlockClose" aria-label="Close">X</button>
                </div>
                <div class="unlockHint">Enter PIN. Press Enter to unlock. Esc to cancel.</div>

                <input id="unlockPin" class="unlockInput" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="Enter PIN" />
                <div id="unlockErr" class="unlockErr"></div>

                <div class="unlockActions">
                    <button id="unlockCancel" type="button" class="btnGhost">Cancel</button>
                    <button id="unlockSubmit" type="button" class="btnPrimary">Unlock</button>
                </div>
            </div>

        </div>

        <div id="visitorBackdrop" class="hidden" aria-hidden="true">
            <div id="visitorModal" role="dialog" aria-modal="true" aria-labelledby="visitorTitle">
                <div class="unlockHeader">
                    <div id="visitorTitle" class="unlockTitle">Visitor</div>
                    <button id="visitorClose" type="button" class="unlockClose" aria-label="Close">X</button>
                </div>
                <div class="unlockHint">Please fill this up. Press Enter to submit. Esc to cancel.</div>

                <div id="visitorNameRow">
                    <input id="visitorName" class="unlockInput" type="text" autocomplete="name" placeholder="Full name" />
                </div>

                <input id="visitorPurpose" class="unlockInput" type="text" autocomplete="off" placeholder="Reason for visit" />
                <div id="visitorErr" class="unlockErr"></div>

                <div class="unlockActions">
                    <button id="visitorCancel" type="button" class="btnGhost">Cancel</button>
                    <button id="visitorSubmit" type="button" class="btnPrimary">Submit</button>
                </div>
            </div>
        </div>

    </div>

    <script src="~/Scripts/jquery-3.7.1.min.js"></script>
    <script type="module" src="@Url.Content("~/Scripts/vendor/mediapipe/tasks-vision/vision_loader.mjs")"></script>
    <script src="@Url.Content("~/Scripts/vendor/toastify/toastify.min.js")"></script>

    <!-- Fullscreen & Permission bootstrap â€” must load BEFORE kiosk.js -->
    <script src="@Url.Content("~/Scripts/kiosk-fullscreen-permission.js")"></script>
    <script src="~/Scripts/kiosk.js?v=@DateTime.UtcNow.Ticks"></script>
</body>
</html>
