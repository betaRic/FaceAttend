/* toastify-lite.js - minimal Toastify-compatible API (local, CSP-safe)
   Provides: Toastify({ text, duration, close, gravity, position, className, style }).showToast()
*/
(function (global) {
  'use strict';

  function applyStyle(el, style) {
    if (!style) return;
    for (var k in style) {
      if (Object.prototype.hasOwnProperty.call(style, k)) {
        try { el.style[k] = style[k]; } catch (e) { /* ignore */ }
      }
    }
  }

  function Toastify(options) {
    options = options || {};
    var text = (options.text == null) ? '' : String(options.text);
    var duration = (typeof options.duration === 'number') ? options.duration : 3000;
    var close = !!options.close;
    var gravity = options.gravity || 'bottom';   // 'top' | 'bottom'
    var position = options.position || 'right';  // 'left' | 'right'
    var className = options.className || '';
    var style = options.style || null;

    var node = document.createElement('div');
    node.className = 'toastify toastify-' + gravity + ' toastify-' + position + (className ? (' ' + className) : '');
    node.setAttribute('role', 'status');
    node.setAttribute('aria-live', 'polite');
    node.textContent = text;

    applyStyle(node, style);

    var timeoutId = null;

    function remove() {
      if (timeoutId) {
        clearTimeout(timeoutId);
        timeoutId = null;
      }
      if (node && node.parentNode) {
        node.classList.remove('toastify-on');
        node.classList.add('toastify-out');
        setTimeout(function () {
          try { node.remove(); } catch (e) { if (node.parentNode) node.parentNode.removeChild(node); }
        }, 220);
      }
    }

    if (close) {
      var btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'toastify-close';
      btn.innerHTML = '&times;';
      btn.addEventListener('click', remove);
      node.appendChild(btn);
    }

    function showToast() {
      document.body.appendChild(node);
      // force reflow so transitions apply
      node.getBoundingClientRect();
      node.classList.add('toastify-on');
      if (duration > 0) {
        timeoutId = setTimeout(remove, duration);
      }
      return this;
    }

    return { showToast: showToast, hideToast: remove };
  }

  global.Toastify = Toastify;
})(window);
