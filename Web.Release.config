<?xml version="1.0"?>
<!--
  Web.Release.config — applied automatically by MSBuild when publishing in Release mode.

  P4-F1 transforms applied:
    1. debug="false"             — removes debug attribute (defaults to false)
    2. customErrors mode="On"    — all users see Error.cshtml, no stack traces
    3. HstsEnabled = true        — enables HSTS header after HTTPS is confirmed working
    4. CspReportOnly = false     — switches CSP from report-only to enforced

  NOTE: machineKey and Admin:AllowedIpRanges must be set manually in Web.config
  (or injected via environment/secrets manager) — they are deployment-specific
  and must NOT be hardcoded in source control transforms.
-->
<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">

  <system.web>

    <!-- Transform 1: Remove debug attribute so it defaults to false in production. -->
    <compilation xdt:Transform="RemoveAttributes(debug)" />

    <!--
      Transform 2: Switch customErrors to On.
      RemoteOnly still shows stack traces to localhost; On hides them from everyone.
    -->
    <customErrors mode="On"
                  xdt:Transform="SetAttributes(mode)" />

  </system.web>

  <appSettings>

    <!--
      Transform 3: Enable HSTS in production.
      Only safe after the HTTPS redirect in Web.config is active and
      the SSL certificate is valid. Flip to false if you need to roll back.
    -->
    <add key="Security:HstsEnabled"
         value="true"
         xdt:Transform="SetAttributes(value)"
         xdt:Locator="Match(key)" />

    <!--
      Transform 4: Enforce CSP (switch from report-only to blocking).
      Run in staging with CspReportOnly=true first and resolve all violations.
      Then set to false here to enforce on publish.
    -->
    <add key="Security:CspReportOnly"
         value="false"
         xdt:Transform="SetAttributes(value)"
         xdt:Locator="Match(key)" />

    <!--
      Transform 5: Ensure Biometrics:Debug is always false in production.
      Belt-and-suspenders — it should already be false in Web.config.
    -->
    <add key="Biometrics:Debug"
         value="false"
         xdt:Transform="SetAttributes(value)"
         xdt:Locator="Match(key)" />

  </appSettings>

</configuration>
